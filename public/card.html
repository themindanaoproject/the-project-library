<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>The Mindanao Project</title>
    <link rel="stylesheet" href="/widget/lib.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;400;500;700;800&family=Rubik:wght@300;400;700&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/rterrado/beta/strawberry-js/v1.2.0.js"></script>
    <script type="text/javascript" src="/widget/app.js"></script>
  </head>
  <body>
    <section id="Loader" class="wrapper flex ac jc">
      <div class="wrapper-inner">
        <img class="icon" src="https://cdn.shopify.com/s/files/1/0560/7466/6159/files/spinner.gif?v=1646281504">
      </div>
    </section>
    <app id="main" xscope="card">
      <header xcomponent="Modules.header"></header>
      <main xpatch="@PageStatus">
        <div xif="pageStatus==true">
          <div class="page-cover-wrapper">
            <div xif="CardModel.images.cover.src==null">
              <div class="page-cover-no-image flex ac">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style="fill:#727272;"><path d="M19 3H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2zM5 19V5h14l.002 14H5z"></path><path d="m10 14-1-1-3 4h12l-5-7z"></path></svg>
                <div class="no-cover-text">No Cover Photo</div>
              </div>
            </div>
          </div>
          <div class="page-body page-wrapper-outer">
            <div class="page-wrapper-inner">
              <div class="card">
                {{CardModel.name}}
              </div>
            </div>
          </div>
        </div>
        <div xif="pageStatus==false">
          <div class="error-page-wrapper">
            <div class="error-page">
              <div class="error-page-inner">
                <div class="error-title">404</div>
                <div class="error-description">
                  Sorry, we couldn't find what you are looking for.
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </app>
    <script type="text/javascript">
      app.scope('card',['Modules'],function($scope,$patch,CardModel){

        $scope.CardModel = CardModel;

        let Params = new URLSearchParams(window.location.search);
        let CardPathBuilder = {
          region:function(){
            let region = Params.get('region');
            return region+'/';
          },
          province:function(){
            let province = Params.get('province');
            if (null===province||'null'===province) {
              return '';
            }
            return province+'/';
          },
          ct:function(){
            let ct = Params.get('ct');
            if (null===ct||'null'===ct) {
              return '';
            }
            return ct+'/';
          }
        }

        let cardPath = '/data/Mindanao/'+CardPathBuilder.region()+CardPathBuilder.province()+CardPathBuilder.ct()+'card.json';

        $scope.searchedKeyword = '';
        if (null!==Params.get('keyword')) {
          $scope.searchedKeyword = Params.get('keyword');
        }

        $scope.pageStatus = true;

        $.ajax({
          type:'GET',
          url:cardPath,
          contentType:'application/json',
          success:function(response){
            console.log(response);
            $scope.pageStatus = true;
            $scope.CardModel.name = response.name;
            $scope.CardModel.images = response.images;
            $patch('PageStatus');
          },
          error:function(error){
            console.log('not found');
            $scope.pageStatus = false;
            $patch('PageStatus');
          }
        });

      });
    </script>
  </body>
</html>
