<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>The Mindanao Project</title>
    <link rel="stylesheet" href="/widget/lib.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;400;500;700;800&family=Rubik:wght@300;400;700&display=swap" rel="stylesheet">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/rterrado/beta/strawberry-js/v1.2.0.js"></script>
    <script type="text/javascript" src="/widget/app.js"></script>
  </head>
  <body>
    <section id="Loader" class="wrapper flex ac jc">
      <div class="wrapper-inner">
        <img class="icon" src="https://cdn.shopify.com/s/files/1/0560/7466/6159/files/spinner.gif?v=1646281504">
      </div>
    </section>
    <app id="main" xscope="card">
      <header xcomponent="Modules.header"></header>
      <main xpatch="@PageStatus">
        <div xif="pageStatus==true">
          <div class="page-cover-wrapper">
            <div xif="CardModel.images.cover.src==null">
              <div class="page-cover-no-image flex ac">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style="fill:#727272;"><path d="M19 3H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2V5c0-1.103-.897-2-2-2zM5 19V5h14l.002 14H5z"></path><path d="m10 14-1-1-3 4h12l-5-7z"></path></svg>
                <div class="no-cover-text">No Cover Photo</div>
              </div>
            </div>
          </div>
          <div class="page-body page-wrapper-outer">
            <div class="page-wrapper-inner">
              <div class="card">
                <div class="card-outer">
                  <div class="card-inner">
                    <div class="card-tags-wrapper card-padding"></div>
                    <div class="card-header card-padding">
                      <div class="card-subtitle">{{Utils.text.capFirst(CardModel.meta.type)}}</div>
                      <div class="card-name">{{CardModel.name}}</div>
                    </div>
                    <div xif="CardModel.traceback.province!==null">
                      <div class="card-spacer"></div>
                      <a href="/card.html?region={{CardModel.traceback.region}}&province={{CardModel.traceback.province}}">
                        <div class="card-padding">
                          <div class="card-subtitle">Province</div>
                          <div class="card-item">{{Utils.text.normalize(CardModel.traceback.province)}}</div>
                        </div>
                      </a>
                    </div>
                    <div xif="CardModel.traceback.region!==null">
                      <div class="card-spacer"></div>
                      <a href="/card.html?region={{CardModel.traceback.region}}">
                        <div class="card-padding">
                          <div class="card-subtitle">Region</div>
                          <div class="card-item">{{Utils.text.normalize(CardModel.traceback.region)}}</div>
                        </div>
                      </a>
                    </div>

                  </div>
                </div>

              </div>
              <div xif="CardModel.meta.type=='province'">
                <div class="sublocation-entry">
                  <div xclick="showSub('cities')" class="sublocation-entry-header">
                    <div class="sublocation-entry-title">Cities</div>
                    <div xpatch="@CitiesCollapsible">
                      <div xif="states.collapsible.cities==true">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;"><path d="m18.707 12.707-1.414-1.414L13 15.586V6h-2v9.586l-4.293-4.293-1.414 1.414L12 19.414z"></path></svg>
                      </div>
                      <div xif="states.collapsible.cities==false">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;"><path d="M11 8.414V18h2V8.414l4.293 4.293 1.414-1.414L12 4.586l-6.707 6.707 1.414 1.414z"></path></svg>
                      </div>
                    </div>
                  </div>
                  <div class="show-sub-cities" style="display:none;">
                    <div class="card subloc-listing">
                      <div xrepeat="CardModel.sublocations.cities as city">
                        <a class="subloc-link" href="">
                          <div class="sublocation-item-wrapper">
                            <div class="sublocation-item">{{city.name}}</div>
                          </div>
                          <div class="card-spacer">

                          </div>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div xif="CardModel.meta.type=='region'">
                Region
              </div>
            </div>
          </div>
        </div>
        <div xif="pageStatus==false">
          <div class="error-page-wrapper">
            <div class="error-page">
              <div class="error-page-inner">
                <div class="error-title">404</div>
                <div class="error-description">
                  Sorry, we couldn't find what you are looking for.
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </app>
    <script type="text/javascript">
      app.scope('card',['Modules'],function($scope,$patch,CardModel,Utils){

        $scope.CardModel = CardModel;
        $scope.Utils = Utils;

        let Params = new URLSearchParams(window.location.search);
        let CardPathBuilder = {
          region:function(){
            let region = Params.get('region');
            return region+'/';
          },
          province:function(){
            let province = Params.get('province');
            if (null===province||'null'===province) {
              return '';
            }
            return province+'/';
          },
          ct:function(){
            let ct = Params.get('ct');
            if (null===ct||'null'===ct) {
              return '';
            }
            return ct+'/';
          }
        }

        let dirPath = '/data/Mindanao/'+CardPathBuilder.region()+CardPathBuilder.province()+CardPathBuilder.ct();
        let cardPath = dirPath+'card.json';

        $scope.searchedKeyword = '';
        if (null!==Params.get('keyword')) {
          $scope.searchedKeyword = Params.get('keyword');
        }

        $scope.pageStatus = true;

        $.ajax({
          type:'GET',
          url:cardPath,
          contentType:'application/json',
          success:function(response){
            $scope.pageStatus = true;
            $scope.CardModel.name = response.name;
            $scope.CardModel.namespace = response.namespace;
            $scope.CardModel.images = response.images;
            $scope.CardModel.meta = response._card;
            $scope.CardModel.traceback = response.traceback;
            $patch('PageStatus');
            if (response._card.type==='province') {
              $.ajax({
                type:'GET',
                url: dirPath+'/cities.json',
                contentType:'application/json',
                success:function(response){
                  for (var key in response) {
                    $scope.CardModel.sublocations.cities.push({
                      name:key,
                      path:response[key]
                    });
                  }
                  $patch('PageStatus');
                },
                error:function(){

                }
              });
            }
          },
          error:function(error){
            console.log('not found');
            $scope.pageStatus = false;
            $patch('PageStatus');
          }
        });

        $scope.states = {
          collapsible:{
            cities:true
          }
        }

        $scope.showSub=function(type){
          if (type==='cities') {
            $('.show-sub-cities').fadeToggle();
            $scope.states.collapsible.cities=!$scope.states.collapsible.cities;
            $patch('CitiesCollapsible');
          }
        }

      });
    </script>
  </body>
</html>
